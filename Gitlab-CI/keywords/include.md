# include
Используйте include для включения внешних файлов YAML в вашу конфигурацию CI/CD. Вы можете разделить один длинный файл .gitlab-ci.yml на несколько файлов, чтобы повысить удобство чтения или уменьшить дублирование одной и той же конфигурации в нескольких местах.
Вы также можете хранить файлы шаблонов в центральном репозитории и включать их в проекты.

Включаемые файлы - это:
- Объединены с содержимым файла .gitlab-ci.yml.
- Всегда сначала обрабатываются, а затем объединяются с содержимым файла .gitlab-ci.yml, независимо от позиции ключевого слова include.

Ограничение по времени для разрешения всех файлов составляет 30 секунд.

**Тип слова:** Глобальное

**Возможные значения:**
Подразделы:
- [include:component](include.md#includecomponent)
- [include:local](include.md#includelocal)
- [include:project](include.md#includeproject)
- [include:remote](include.md#includeremote)
- [include:template](include.md#includetemplate)

Опционально:
- [include:inputs](include.md#includeinputs)
- [include:rules](include.md#includerules)

**Дополнительные сведения:**
- С ключевыми словами include можно использовать только определенные переменные CI/CD.
- Используйте объединение для настройки и переопределения включенных конфигураций CI/CD с помощью local
- Вы можете переопределить включенную конфигурацию, указав то же имя задания или глобальное ключевое слово в файле .gitlab-ci.yml. Эти две конфигурации объединяются вместе, и конфигурация в файле .gitlab-ci.yml имеет приоритет над включенной конфигурацией.
- Если вы повторно запустите:
    - При выполнении задания включаемые файлы больше не извлекаются. Во всех заданиях конвейера используется конфигурация, выбранная при создании конвейера. Любые изменения в исходных включаемых файлах не влияют на повторное выполнение задания.
    - При выполнении конвейера включаемые файлы извлекаются снова. Если они изменились после последнего запуска конвейера, то новый конвейер использует измененную конфигурацию.
- По умолчанию в каждом конвейере может быть до 150 включений, включая вложенные. Дополнительно:
    - В GitLab 16.0 и более поздних версиях пользователи с автономным управлением могут изменять максимальное значение включений.
    - В GitLab 15.10 и более поздних версиях у вас может быть до 150 включений. Во вложенных включениях один и тот же файл может быть включен несколько раз, но количество дублированных включений ограничено.
    - С GitLab 14.9 по GitLab 15.9 у вас может быть до 100 включений. Один и тот же файл может быть включен во вложенные файлы несколько раз, но дубликаты игнорируются.

## include:component
Используйте include:component для добавления компонента CI/CD в конфигурацию конвейера.

**Тип слова:** Глобальное

**Возможные значения:** Полный адрес компонента CI/CD, отформатированный как <полное доменное имя>/<путь к проекту>/<имя компонента>@<конкретная версия> (<fully-qualified-domain-name>/<project-path>/<component-name>@<specific-version>).

**Пример:**
```YAML
include:
  - component: $CI_SERVER_FQDN/my-org/security-components/secret-detection@1.0
```
**Связанные темы:**
- [Использование компонентов CI/CD](https://docs.gitlab.com/ee/ci/components/index.html#use-a-component)

## include:local
Используйте include:local, чтобы включить файл, который находится в том же репозитории и в той же ветви, что и файл конфигурации, содержащий ключевое слово include. Используйте include:local вместо символических ссылок.

**Тип слова:** Глобальное

**Возможные значения:** 
Полный путь к корневому каталогу (/):
- Файл YAML должен иметь расширение .yml или .yaml.
- Вы можете использовать подстановочные знаки * и ** в пути к файлу.
- Вы можете использовать определенные переменные CI/CD.

**Пример:**
```YAML
include:
  - local: '/templates/.gitlab-ci-template.yml'
```

Вы также можете использовать более короткий синтаксис для определения пути:

```YAML
include: '.gitlab-ci-production.yml'
```

**Дополнительные сведения:**
- Файл .gitlab-ci.yml и локальный файл должны находиться в одной ветке.
- Вы не можете включать локальные файлы через пути к подмодулям Git.
- Конфигурация include всегда оценивается на основе местоположения файла, содержащего ключевое слово include, а не проекта, в котором выполняется конвейер. Если вложенный include находится в файле конфигурации другого проекта, include: local проверяет наличие файла в другом проекте.

## include:project
Чтобы включить файлы из другого частного проекта в тот же экземпляр GitLab, используйте include:project и include:file.

**Тип слова:** Глобальное

**Возможные значения:** 
- include:project: Полный путь к проекту GitLab.
- include:file: указать полный путь к файлу или массив путей к файлам относительно корневого каталога (/). Файлы YAML должны иметь расширение .yml или .yaml.
- include:ref: Необязательно. Ссылка для получения файла. По умолчанию используется заголовок проекта, если он не указан.
- Вы можете использовать [определенные переменные CI/CD](https://docs.gitlab.com/ee/ci/yaml/includes.html#use-variables-with-include).

**Пример:**
```YAML
include:
  - project: 'my-group/my-project'
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-subgroup/my-project-2'
    file:
      - '/templates/.builds.yml'
      - '/templates/.tests.yml'
```

Вы также можете указать ссылку:

```YAML
include:
  - project: 'my-group/my-project'
    ref: main                                      # Git branch
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-project'
    ref: v1.0.0                                    # Git Tag
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-project'
    ref: 787123b47f14b552955ca2786bc9542ae66fee5b  # Git SHA
    file: '/templates/.gitlab-ci-template.yml'
```

**Дополнительные сведения:**
- Конфигурация include всегда оценивается на основе местоположения файла, содержащего ключевое слово include, а не проекта, в котором выполняется конвейер. Если вложенный include находится в файле конфигурации другого проекта, include: local проверяет наличие файла в этом другом проекте.
- При запуске конвейера проверяется конфигурация файла .gitlab-ci.yml, включенная всеми методами. Конфигурация является моментальным снимком во времени и сохраняется в базе данных. GitLab не отображает никаких изменений в конфигурации файла .gitlab-ci.yml, на который ссылается ссылка, до запуска следующего конвейера.
- При включении файла YAML из другого частного проекта пользователь, запускающий конвейер, должен быть участником обоих проектов и иметь соответствующие разрешения для запуска конвейеров. Если у пользователя нет доступа ни к одному из включенных файлов, может отображаться ошибка "Не найден" или "отказано в доступе".
- Будьте осторожны при включении файла конфигурации CI/CD другого проекта. При изменении файлов конфигурации CI/CD не запускаются конвейеры или уведомления. С точки зрения безопасности это похоже на использование сторонних зависимостей. Что касается ссылки, рассмотрите:
    - Используя определенный SHA-хэш, который должен быть наиболее стабильным вариантом. Используйте полный 40-символьный SHA-хэш, чтобы убедиться, что есть ссылка на желаемую фиксацию, поскольку использование короткого SHA-хэша для ссылки может быть неоднозначным.
    - Применение правил защищенной ветви и защищенных тегов к ссылке в другом проекте. Защищенные теги и ветви, скорее всего, пройдут процедуру управления изменениями перед изменением.

## include:remote
Используйте include:remote с полным URL-адресом, чтобы включить файл из другого расположения.

**Тип слова:** Глобальное

**Возможные значения:** 
Общедоступный URL-адрес, доступный по HTTP/HTTPS GET-запросу:
- Аутентификация с помощью удаленного URL-адреса не поддерживается.
- Файл YAML должен иметь расширение .yml или .yaml.
- Вы можете использовать [определенные переменные CI/CD](https://docs.gitlab.com/ee/ci/yaml/includes.html#use-variables-with-include).

**Пример:**
```YAML
include:
  - remote: 'https://gitlab.com/example-project/-/raw/main/.gitlab-ci.yml'
```

**Дополнительные сведения:**
- Все вложенные включения выполняются без контекста от имени общедоступного пользователя, поэтому вы можете включать только общедоступные проекты или шаблоны. В разделе "Включить" вложенных включений нет доступных переменных.
- Будьте осторожны при включении файла конфигурации CI/CD другого проекта. При изменении файлов другого проекта не запускаются конвейеры или уведомления. С точки зрения безопасности это похоже на использование сторонних зависимостей. Если вы ссылаетесь на другой проект GitLab, которым владеете, рассмотрите возможность использования как защищенных ветвей, так и защищенных тегов для обеспечения соблюдения правил управления изменениями.

## include:template
Используйте include:template для включения шаблонов .gitlab-ci.yml.

**Тип слова:** Глобальное

**Возможные значения:** 
Шаблон CI/CD:
- Все шаблоны можно просмотреть в lib/gitlab/ci/templates. Не все шаблоны предназначены для использования с шаблоном include:, поэтому перед использованием ознакомьтесь с комментариями к шаблону.
- Вы можете использовать [определенные переменные CI/CD](https://docs.gitlab.com/ee/ci/yaml/includes.html#use-variables-with-include).

**Пример:**
```YAML
# File sourced from the GitLab template collection
include:
  - template: Auto-DevOps.gitlab-ci.yml
```

Множественное включение:

```YAML
include:
  - template: Android-Fastlane.gitlab-ci.yml
  - template: Auto-DevOps.gitlab-ci.yml
```

**Дополнительные сведения:**
- Все вложенные включения выполняются без контекста от имени общедоступного пользователя, поэтому вы можете включать только общедоступные проекты или шаблоны. В разделе "Включить" вложенных включений нет доступных переменных.

## include:inputs
Используйте include:inputs для установки значений входных параметров, когда включенная конфигурация использует spec:inputs и добавляется в конвейер.

**Тип слова:** Глобальное

**Возможные значения:** Строка, числовое значение или логическое выражение.

**Пример:**
```YAML
include:
  - local: 'custom_configuration.yml'
    inputs:
      website: "My website"
```

В этом примере:
- Конфигурация, содержащаяся в custom_configuration.yml добавляется в конвейер, при этом для входных данных веб-сайта устанавливается значение My website для включенной конфигурации.

**Дополнительные сведения:**
- Если во включенном файле конфигурации используется spec:inputs:type, входное значение должно соответствовать определенному типу.
- Если во включенном файле конфигурации используется spec:inputs:options, входное значение должно соответствовать одному из перечисленных параметров.

**Связанные темы:**
- [Установка входных значений при использовании include](https://docs.gitlab.com/ee/ci/yaml/inputs.html#set-input-values-when-using-include)

## include:rules
Вы можете использовать rules с include для условного включения других конфигурационных файлов.

**Тип слова:** Глобальное

**Возможные значения:**
Подразделы:
- rules:if
- rules:exists
- rules:changes

[Поддерживаются некоторые переменные CI/CD](https://docs.gitlab.com/ee/ci/yaml/includes.html#use-variables-with-include).

**Пример:**
```YAML
include:
  - local: build_jobs.yml
    rules:
      - if: $INCLUDE_BUILDS == "true"

test-job:
  stage: test
  script: echo "This is a test job"
```

В этом примере, если переменная INCLUDE_BUILDS имеет значение:
- true, конфигурация build_jobs.yml включена в конвейер.
- Если значение не соответствует действительности или не существует, конфигурация build_jobs.yml не включена в конвейер.